---
interface Props {
  lang?: string;
}

const { lang = 'en' } = Astro.props;

// Import translations
import en from '../data/translations/en.json';
import fr from '../data/translations/fr.json';
import es from '../data/translations/es.json';
import de from '../data/translations/de.json';
import it from '../data/translations/it.json';
import pt from '../data/translations/pt.json';
import nl from '../data/translations/nl.json';
import pl from '../data/translations/pl.json';
import ar from '../data/translations/ar.json';
import tr from '../data/translations/tr.json';
import ru from '../data/translations/ru.json';
import zhCN from '../data/translations/zh-CN.json';
import zhTW from '../data/translations/zh-TW.json';
import ja from '../data/translations/ja.json';
import ko from '../data/translations/ko.json';
import th from '../data/translations/th.json';
import vi from '../data/translations/vi.json';
import id from '../data/translations/id.json';
import hi from '../data/translations/hi.json';
import sv from '../data/translations/sv.json';
import no from '../data/translations/no.json';
import da from '../data/translations/da.json';

const translationsMap: Record<string, any> = {
  en, fr, es, de, it, pt, nl, pl, ar, tr, ru,
  'zh-CN': zhCN, 'zh-TW': zhTW, ja, ko, th, vi, id, hi, sv, no, da
};

const translations = translationsMap[lang] || en;
const socialProof = translations.socialProof || en.socialProof;
---

<div class="social-proof" id="social-proof" aria-live="polite" aria-atomic="true">
  <button class="social-proof__close" aria-label="Close notification" type="button">
    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1 1L13 13M1 13L13 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
  <div class="social-proof__content">
    <span class="social-proof__flag" id="social-proof-flag"></span>
    <div class="social-proof__text">
      <span class="social-proof__message" id="social-proof-message"></span>
      <span class="social-proof__time" id="social-proof-time"></span>
    </div>
  </div>
</div>

<script define:vars={{ lang, socialProof }}>
  // Signups pool - biased towards AvaTrade, then AvaFutures
  // Note: Spain (ES) only shows AvaFutures due to CNMV CFD restrictions
  const signups = [
    // AvaTrade - most frequent (no Spain)
    { countryCode: 'DE', broker: 'AvaTrade', minutesAgo: 2 },
    { countryCode: 'IT', broker: 'AvaTrade', minutesAgo: 3 },
    { countryCode: 'GB', broker: 'AvaTrade', minutesAgo: 4 },
    { countryCode: 'ZA', broker: 'AvaTrade', minutesAgo: 2 },
    { countryCode: 'FR', broker: 'AvaTrade', minutesAgo: 5 },
    { countryCode: 'AE', broker: 'AvaTrade', minutesAgo: 2 },
    { countryCode: 'AU', broker: 'AvaTrade', minutesAgo: 3 },
    { countryCode: 'NL', broker: 'AvaTrade', minutesAgo: 4 },
    { countryCode: 'SE', broker: 'AvaTrade', minutesAgo: 6 },
    { countryCode: 'AT', broker: 'AvaTrade', minutesAgo: 3 },
    { countryCode: 'PT', broker: 'AvaTrade', minutesAgo: 2 },
    { countryCode: 'KR', broker: 'AvaTrade', minutesAgo: 4 },
    { countryCode: 'SG', broker: 'AvaTrade', minutesAgo: 5 },
    { countryCode: 'CH', broker: 'AvaTrade', minutesAgo: 3 },
    // AvaFutures - secondary (includes Spain)
    { countryCode: 'ES', broker: 'AvaFutures', minutesAgo: 3 },
    { countryCode: 'DE', broker: 'AvaFutures', minutesAgo: 5 },
    { countryCode: 'IT', broker: 'AvaFutures', minutesAgo: 4 },
    { countryCode: 'FR', broker: 'AvaFutures', minutesAgo: 6 },
    { countryCode: 'GB', broker: 'AvaFutures', minutesAgo: 7 },
    { countryCode: 'AU', broker: 'AvaFutures', minutesAgo: 4 },
    // XM - less frequent
    { countryCode: 'BR', broker: 'XM', minutesAgo: 5 },
    { countryCode: 'PL', broker: 'XM', minutesAgo: 6 },
    { countryCode: 'JP', broker: 'XM', minutesAgo: 8 },
    // Exness - occasional
    { countryCode: 'NO', broker: 'Exness', minutesAgo: 4 },
    { countryCode: 'CA', broker: 'Exness', minutesAgo: 7 },
  ];

  // Country flags mapping
  const flags = {
    DE: 'ðŸ‡©ðŸ‡ª', IT: 'ðŸ‡®ðŸ‡¹', GB: 'ðŸ‡¬ðŸ‡§', ZA: 'ðŸ‡¿ðŸ‡¦', FR: 'ðŸ‡«ðŸ‡·',
    AE: 'ðŸ‡¦ðŸ‡ª', CA: 'ðŸ‡¨ðŸ‡¦', AU: 'ðŸ‡¦ðŸ‡º', CH: 'ðŸ‡¨ðŸ‡­', SG: 'ðŸ‡¸ðŸ‡¬',
    NL: 'ðŸ‡³ðŸ‡±', BR: 'ðŸ‡§ðŸ‡·', SE: 'ðŸ‡¸ðŸ‡ª', NO: 'ðŸ‡³ðŸ‡´', PL: 'ðŸ‡µðŸ‡±',
    AT: 'ðŸ‡¦ðŸ‡¹', BE: 'ðŸ‡§ðŸ‡ª', PT: 'ðŸ‡µðŸ‡¹', JP: 'ðŸ‡¯ðŸ‡µ', KR: 'ðŸ‡°ðŸ‡·',
    ES: 'ðŸ‡ªðŸ‡¸'
  };

  // Localized country names for all 21 languages
  const countryNames = {
    en: { DE: 'Germany', IT: 'Italy', GB: 'United Kingdom', ZA: 'South Africa', FR: 'France', AE: 'UAE', CA: 'Canada', AU: 'Australia', CH: 'Switzerland', SG: 'Singapore', NL: 'Netherlands', BR: 'Brazil', SE: 'Sweden', NO: 'Norway', PL: 'Poland', AT: 'Austria', BE: 'Belgium', PT: 'Portugal', JP: 'Japan', KR: 'South Korea', ES: 'Spain' },
    fr: { DE: 'Allemagne', IT: 'Italie', GB: 'Royaume-Uni', ZA: 'Afrique du Sud', FR: 'France', AE: 'EAU', CA: 'Canada', AU: 'Australie', CH: 'Suisse', SG: 'Singapour', NL: 'Pays-Bas', BR: 'BrÃ©sil', SE: 'SuÃ¨de', NO: 'NorvÃ¨ge', PL: 'Pologne', AT: 'Autriche', BE: 'Belgique', PT: 'Portugal', JP: 'Japon', KR: 'CorÃ©e du Sud', ES: 'Espagne' },
    es: { DE: 'Alemania', IT: 'Italia', GB: 'Reino Unido', ZA: 'SudÃ¡frica', FR: 'Francia', AE: 'EAU', CA: 'CanadÃ¡', AU: 'Australia', CH: 'Suiza', SG: 'Singapur', NL: 'PaÃ­ses Bajos', BR: 'Brasil', SE: 'Suecia', NO: 'Noruega', PL: 'Polonia', AT: 'Austria', BE: 'BÃ©lgica', PT: 'Portugal', JP: 'JapÃ³n', KR: 'Corea del Sur', ES: 'EspaÃ±a' },
    de: { DE: 'Deutschland', IT: 'Italien', GB: 'Vereinigtes KÃ¶nigreich', ZA: 'SÃ¼dafrika', FR: 'Frankreich', AE: 'VAE', CA: 'Kanada', AU: 'Australien', CH: 'Schweiz', SG: 'Singapur', NL: 'Niederlande', BR: 'Brasilien', SE: 'Schweden', NO: 'Norwegen', PL: 'Polen', AT: 'Ã–sterreich', BE: 'Belgien', PT: 'Portugal', JP: 'Japan', KR: 'SÃ¼dkorea', ES: 'Spanien' },
    it: { DE: 'Germania', IT: 'Italia', GB: 'Regno Unito', ZA: 'Sudafrica', FR: 'Francia', AE: 'EAU', CA: 'Canada', AU: 'Australia', CH: 'Svizzera', SG: 'Singapore', NL: 'Paesi Bassi', BR: 'Brasile', SE: 'Svezia', NO: 'Norvegia', PL: 'Polonia', AT: 'Austria', BE: 'Belgio', PT: 'Portogallo', JP: 'Giappone', KR: 'Corea del Sud', ES: 'Spagna' },
    pt: { DE: 'Alemanha', IT: 'ItÃ¡lia', GB: 'Reino Unido', ZA: 'Ãfrica do Sul', FR: 'FranÃ§a', AE: 'EAU', CA: 'CanadÃ¡', AU: 'AustrÃ¡lia', CH: 'SuÃ­Ã§a', SG: 'Singapura', NL: 'PaÃ­ses Baixos', BR: 'Brasil', SE: 'SuÃ©cia', NO: 'Noruega', PL: 'PolÃ³nia', AT: 'Ãustria', BE: 'BÃ©lgica', PT: 'Portugal', JP: 'JapÃ£o', KR: 'Coreia do Sul', ES: 'Espanha' },
    nl: { DE: 'Duitsland', IT: 'ItaliÃ«', GB: 'Verenigd Koninkrijk', ZA: 'Zuid-Afrika', FR: 'Frankrijk', AE: 'VAE', CA: 'Canada', AU: 'AustraliÃ«', CH: 'Zwitserland', SG: 'Singapore', NL: 'Nederland', BR: 'BraziliÃ«', SE: 'Zweden', NO: 'Noorwegen', PL: 'Polen', AT: 'Oostenrijk', BE: 'BelgiÃ«', PT: 'Portugal', JP: 'Japan', KR: 'Zuid-Korea', ES: 'Spanje' },
    pl: { DE: 'Niemcy', IT: 'WÅ‚ochy', GB: 'Wielka Brytania', ZA: 'Republika PoÅ‚udniowej Afryki', FR: 'Francja', AE: 'ZEA', CA: 'Kanada', AU: 'Australia', CH: 'Szwajcaria', SG: 'Singapur', NL: 'Holandia', BR: 'Brazylia', SE: 'Szwecja', NO: 'Norwegia', PL: 'Polska', AT: 'Austria', BE: 'Belgia', PT: 'Portugalia', JP: 'Japonia', KR: 'Korea PoÅ‚udniowa', ES: 'Hiszpania' },
    ar: { DE: 'Ø£Ù„Ù…Ø§Ù†ÙŠØ§', IT: 'Ø¥ÙŠØ·Ø§Ù„ÙŠØ§', GB: 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©', ZA: 'Ø¬Ù†ÙˆØ¨ Ø£ÙØ±ÙŠÙ‚ÙŠØ§', FR: 'ÙØ±Ù†Ø³Ø§', AE: 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª', CA: 'ÙƒÙ†Ø¯Ø§', AU: 'Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§', CH: 'Ø³ÙˆÙŠØ³Ø±Ø§', SG: 'Ø³Ù†ØºØ§ÙÙˆØ±Ø©', NL: 'Ù‡ÙˆÙ„Ù†Ø¯Ø§', BR: 'Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„', SE: 'Ø§Ù„Ø³ÙˆÙŠØ¯', NO: 'Ø§Ù„Ù†Ø±ÙˆÙŠØ¬', PL: 'Ø¨ÙˆÙ„Ù†Ø¯Ø§', AT: 'Ø§Ù„Ù†Ù…Ø³Ø§', BE: 'Ø¨Ù„Ø¬ÙŠÙƒØ§', PT: 'Ø§Ù„Ø¨Ø±ØªØºØ§Ù„', JP: 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', KR: 'ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©', ES: 'Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§' },
    tr: { DE: 'Almanya', IT: 'Ä°talya', GB: 'BirleÅŸik KrallÄ±k', ZA: 'GÃ¼ney Afrika', FR: 'Fransa', AE: 'BAE', CA: 'Kanada', AU: 'Avustralya', CH: 'Ä°sviÃ§re', SG: 'Singapur', NL: 'Hollanda', BR: 'Brezilya', SE: 'Ä°sveÃ§', NO: 'NorveÃ§', PL: 'Polonya', AT: 'Avusturya', BE: 'BelÃ§ika', PT: 'Portekiz', JP: 'Japonya', KR: 'GÃ¼ney Kore', ES: 'Ä°spanya' },
    ru: { DE: 'Ð“ÐµÑ€Ð¼Ð°Ð½Ð¸Ñ', IT: 'Ð˜Ñ‚Ð°Ð»Ð¸Ñ', GB: 'Ð’ÐµÐ»Ð¸ÐºÐ¾Ð±Ñ€Ð¸Ñ‚Ð°Ð½Ð¸Ñ', ZA: 'Ð®ÐÐ ', FR: 'Ð¤Ñ€Ð°Ð½Ñ†Ð¸Ñ', AE: 'ÐžÐÐ­', CA: 'ÐšÐ°Ð½Ð°Ð´Ð°', AU: 'ÐÐ²ÑÑ‚Ñ€Ð°Ð»Ð¸Ñ', CH: 'Ð¨Ð²ÐµÐ¹Ñ†Ð°Ñ€Ð¸Ñ', SG: 'Ð¡Ð¸Ð½Ð³Ð°Ð¿ÑƒÑ€', NL: 'ÐÐ¸Ð´ÐµÑ€Ð»Ð°Ð½Ð´Ñ‹', BR: 'Ð‘Ñ€Ð°Ð·Ð¸Ð»Ð¸Ñ', SE: 'Ð¨Ð²ÐµÑ†Ð¸Ñ', NO: 'ÐÐ¾Ñ€Ð²ÐµÐ³Ð¸Ñ', PL: 'ÐŸÐ¾Ð»ÑŒÑˆÐ°', AT: 'ÐÐ²ÑÑ‚Ñ€Ð¸Ñ', BE: 'Ð‘ÐµÐ»ÑŒÐ³Ð¸Ñ', PT: 'ÐŸÐ¾Ñ€Ñ‚ÑƒÐ³Ð°Ð»Ð¸Ñ', JP: 'Ð¯Ð¿Ð¾Ð½Ð¸Ñ', KR: 'Ð®Ð¶Ð½Ð°Ñ ÐšÐ¾Ñ€ÐµÑ', ES: 'Ð˜ÑÐ¿Ð°Ð½Ð¸Ñ' },
    'zh-CN': { DE: 'å¾·å›½', IT: 'æ„å¤§åˆ©', GB: 'è‹±å›½', ZA: 'å—éž', FR: 'æ³•å›½', AE: 'é˜¿è”é…‹', CA: 'åŠ æ‹¿å¤§', AU: 'æ¾³å¤§åˆ©äºš', CH: 'ç‘žå£«', SG: 'æ–°åŠ å¡', NL: 'è·å…°', BR: 'å·´è¥¿', SE: 'ç‘žå…¸', NO: 'æŒªå¨', PL: 'æ³¢å…°', AT: 'å¥¥åœ°åˆ©', BE: 'æ¯”åˆ©æ—¶', PT: 'è‘¡è„ç‰™', JP: 'æ—¥æœ¬', KR: 'éŸ©å›½', ES: 'è¥¿ç­ç‰™' },
    'zh-TW': { DE: 'å¾·åœ‹', IT: 'ç¾©å¤§åˆ©', GB: 'è‹±åœ‹', ZA: 'å—éž', FR: 'æ³•åœ‹', AE: 'é˜¿è¯é…‹', CA: 'åŠ æ‹¿å¤§', AU: 'æ¾³æ´²', CH: 'ç‘žå£«', SG: 'æ–°åŠ å¡', NL: 'è·è˜­', BR: 'å·´è¥¿', SE: 'ç‘žå…¸', NO: 'æŒªå¨', PL: 'æ³¢è˜­', AT: 'å¥§åœ°åˆ©', BE: 'æ¯”åˆ©æ™‚', PT: 'è‘¡è„ç‰™', JP: 'æ—¥æœ¬', KR: 'éŸ“åœ‹', ES: 'è¥¿ç­ç‰™' },
    ja: { DE: 'ãƒ‰ã‚¤ãƒ„', IT: 'ã‚¤ã‚¿ãƒªã‚¢', GB: 'ã‚¤ã‚®ãƒªã‚¹', ZA: 'å—ã‚¢ãƒ•ãƒªã‚«', FR: 'ãƒ•ãƒ©ãƒ³ã‚¹', AE: 'UAE', CA: 'ã‚«ãƒŠãƒ€', AU: 'ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢', CH: 'ã‚¹ã‚¤ã‚¹', SG: 'ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«', NL: 'ã‚ªãƒ©ãƒ³ãƒ€', BR: 'ãƒ–ãƒ©ã‚¸ãƒ«', SE: 'ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³', NO: 'ãƒŽãƒ«ã‚¦ã‚§ãƒ¼', PL: 'ãƒãƒ¼ãƒ©ãƒ³ãƒ‰', AT: 'ã‚ªãƒ¼ã‚¹ãƒˆãƒªã‚¢', BE: 'ãƒ™ãƒ«ã‚®ãƒ¼', PT: 'ãƒãƒ«ãƒˆã‚¬ãƒ«', JP: 'æ—¥æœ¬', KR: 'éŸ“å›½', ES: 'ã‚¹ãƒšã‚¤ãƒ³' },
    ko: { DE: 'ë…ì¼', IT: 'ì´íƒˆë¦¬ì•„', GB: 'ì˜êµ­', ZA: 'ë‚¨ì•„í”„ë¦¬ì¹´', FR: 'í”„ëž‘ìŠ¤', AE: 'UAE', CA: 'ìºë‚˜ë‹¤', AU: 'í˜¸ì£¼', CH: 'ìŠ¤ìœ„ìŠ¤', SG: 'ì‹±ê°€í¬ë¥´', NL: 'ë„¤ëœëž€ë“œ', BR: 'ë¸Œë¼ì§ˆ', SE: 'ìŠ¤ì›¨ë´', NO: 'ë…¸ë¥´ì›¨ì´', PL: 'í´ëž€ë“œ', AT: 'ì˜¤ìŠ¤íŠ¸ë¦¬ì•„', BE: 'ë²¨ê¸°ì—', PT: 'í¬ë¥´íˆ¬ê°ˆ', JP: 'ì¼ë³¸', KR: 'í•œêµ­', ES: 'ìŠ¤íŽ˜ì¸' },
    th: { DE: 'à¹€à¸¢à¸­à¸£à¸¡à¸™à¸µ', IT: 'à¸­à¸´à¸•à¸²à¸¥à¸µ', GB: 'à¸ªà¸«à¸£à¸²à¸Šà¸­à¸²à¸“à¸²à¸ˆà¸±à¸à¸£', ZA: 'à¹à¸­à¸Ÿà¸£à¸´à¸à¸²à¹ƒà¸•à¹‰', FR: 'à¸à¸£à¸±à¹ˆà¸‡à¹€à¸¨à¸ª', AE: 'à¸¢à¸¹à¹€à¸­à¸­à¸µ', CA: 'à¹à¸„à¸™à¸²à¸”à¸²', AU: 'à¸­à¸­à¸ªà¹€à¸•à¸£à¹€à¸¥à¸µà¸¢', CH: 'à¸ªà¸§à¸´à¸•à¹€à¸‹à¸­à¸£à¹Œà¹à¸¥à¸™à¸”à¹Œ', SG: 'à¸ªà¸´à¸‡à¸„à¹‚à¸›à¸£à¹Œ', NL: 'à¹€à¸™à¹€à¸˜à¸­à¸£à¹Œà¹à¸¥à¸™à¸”à¹Œ', BR: 'à¸šà¸£à¸²à¸‹à¸´à¸¥', SE: 'à¸ªà¸§à¸µà¹€à¸”à¸™', NO: 'à¸™à¸­à¸£à¹Œà¹€à¸§à¸¢à¹Œ', PL: 'à¹‚à¸›à¹à¸¥à¸™à¸”à¹Œ', AT: 'à¸­à¸­à¸ªà¹€à¸•à¸£à¸µà¸¢', BE: 'à¹€à¸šà¸¥à¹€à¸¢à¸µà¸¢à¸¡', PT: 'à¹‚à¸›à¸£à¸•à¸¸à¹€à¸à¸ª', JP: 'à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™', KR: 'à¹€à¸à¸²à¸«à¸¥à¸µà¹ƒà¸•à¹‰', ES: 'à¸ªà¹€à¸›à¸™' },
    vi: { DE: 'Äá»©c', IT: 'Ã', GB: 'Anh', ZA: 'Nam Phi', FR: 'PhÃ¡p', AE: 'UAE', CA: 'Canada', AU: 'Ãšc', CH: 'Thá»¥y SÄ©', SG: 'Singapore', NL: 'HÃ  Lan', BR: 'Brazil', SE: 'Thá»¥y Äiá»ƒn', NO: 'Na Uy', PL: 'Ba Lan', AT: 'Ão', BE: 'Bá»‰', PT: 'Bá»“ ÄÃ o Nha', JP: 'Nháº­t Báº£n', KR: 'HÃ n Quá»‘c', ES: 'TÃ¢y Ban Nha' },
    id: { DE: 'Jerman', IT: 'Italia', GB: 'Inggris', ZA: 'Afrika Selatan', FR: 'Prancis', AE: 'UEA', CA: 'Kanada', AU: 'Australia', CH: 'Swiss', SG: 'Singapura', NL: 'Belanda', BR: 'Brasil', SE: 'Swedia', NO: 'Norwegia', PL: 'Polandia', AT: 'Austria', BE: 'Belgia', PT: 'Portugal', JP: 'Jepang', KR: 'Korea Selatan', ES: 'Spanyol' },
    hi: { DE: 'à¤œà¤°à¥à¤®à¤¨à¥€', IT: 'à¤‡à¤Ÿà¤²à¥€', GB: 'à¤¯à¥‚à¤¨à¤¾à¤‡à¤Ÿà¥‡à¤¡ à¤•à¤¿à¤‚à¤—à¤¡à¤®', ZA: 'à¤¦à¤•à¥à¤·à¤¿à¤£ à¤…à¤«à¥à¤°à¥€à¤•à¤¾', FR: 'à¤«à¥à¤°à¤¾à¤‚à¤¸', AE: 'à¤¯à¥‚à¤à¤ˆ', CA: 'à¤•à¤¨à¤¾à¤¡à¤¾', AU: 'à¤‘à¤¸à¥à¤Ÿà¥à¤°à¥‡à¤²à¤¿à¤¯à¤¾', CH: 'à¤¸à¥à¤µà¤¿à¤Ÿà¥à¤œà¤°à¤²à¥ˆà¤‚à¤¡', SG: 'à¤¸à¤¿à¤‚à¤—à¤¾à¤ªà¥à¤°', NL: 'à¤¨à¥€à¤¦à¤°à¤²à¥ˆà¤‚à¤¡', BR: 'à¤¬à¥à¤°à¤¾à¤œà¥€à¤²', SE: 'à¤¸à¥à¤µà¥€à¤¡à¤¨', NO: 'à¤¨à¥‰à¤°à¥à¤µà¥‡', PL: 'à¤ªà¥‹à¤²à¥ˆà¤‚à¤¡', AT: 'à¤‘à¤¸à¥à¤Ÿà¥à¤°à¤¿à¤¯à¤¾', BE: 'à¤¬à¥‡à¤²à¥à¤œà¤¿à¤¯à¤®', PT: 'à¤ªà¥à¤°à¥à¤¤à¤—à¤¾à¤²', JP: 'à¤œà¤¾à¤ªà¤¾à¤¨', KR: 'à¤¦à¤•à¥à¤·à¤¿à¤£ à¤•à¥‹à¤°à¤¿à¤¯à¤¾', ES: 'à¤¸à¥à¤ªà¥‡à¤¨' },
    sv: { DE: 'Tyskland', IT: 'Italien', GB: 'Storbritannien', ZA: 'Sydafrika', FR: 'Frankrike', AE: 'FÃ¶renade Arabemiraten', CA: 'Kanada', AU: 'Australien', CH: 'Schweiz', SG: 'Singapore', NL: 'NederlÃ¤nderna', BR: 'Brasilien', SE: 'Sverige', NO: 'Norge', PL: 'Polen', AT: 'Ã–sterrike', BE: 'Belgien', PT: 'Portugal', JP: 'Japan', KR: 'Sydkorea', ES: 'Spanien' },
    no: { DE: 'Tyskland', IT: 'Italia', GB: 'Storbritannia', ZA: 'SÃ¸r-Afrika', FR: 'Frankrike', AE: 'De forente arabiske emirater', CA: 'Canada', AU: 'Australia', CH: 'Sveits', SG: 'Singapore', NL: 'Nederland', BR: 'Brasil', SE: 'Sverige', NO: 'Norge', PL: 'Polen', AT: 'Ã˜sterrike', BE: 'Belgia', PT: 'Portugal', JP: 'Japan', KR: 'SÃ¸r-Korea', ES: 'Spania' },
    da: { DE: 'Tyskland', IT: 'Italien', GB: 'Storbritannien', ZA: 'Sydafrika', FR: 'Frankrig', AE: 'De Forenede Arabiske Emirater', CA: 'Canada', AU: 'Australien', CH: 'Schweiz', SG: 'Singapore', NL: 'Holland', BR: 'Brasilien', SE: 'Sverige', NO: 'Norge', PL: 'Polen', AT: 'Ã˜strig', BE: 'Belgien', PT: 'Portugal', JP: 'Japan', KR: 'Sydkorea', ES: 'Spanien' }
  };

  const STORAGE_KEY = 'socialProofState';
  const MAX_NOTIFICATIONS = 3;
  const MIN_INTERVAL = 30000; // 30 seconds
  const MAX_INTERVAL = 60000; // 60 seconds
  const DISPLAY_DURATION = 4000; // 4 seconds
  const INITIAL_DELAY = 8000; // 8 seconds before first notification

  // Get session state from localStorage
  function getState() {
    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        const state = JSON.parse(stored);
        // Reset if it's a new session (more than 30 minutes since last activity)
        if (Date.now() - state.lastActivity > 30 * 60 * 1000) {
          return { count: 0, dismissed: false, lastActivity: Date.now(), lastIndex: -1 };
        }
        return state;
      }
    } catch (e) {}
    return { count: 0, dismissed: false, lastActivity: Date.now(), lastIndex: -1 };
  }

  // Save session state
  function saveState(state) {
    try {
      state.lastActivity = Date.now();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (e) {}
  }

  // Get a random signup (avoiding repeat of last shown)
  function getRandomSignup(lastIndex) {
    let index;
    do {
      index = Math.floor(Math.random() * signups.length);
    } while (index === lastIndex && signups.length > 1);
    return { signup: signups[index], index };
  }

  // Show notification
  function showNotification(signup) {
    const container = document.getElementById('social-proof');
    const flagEl = document.getElementById('social-proof-flag');
    const messageEl = document.getElementById('social-proof-message');
    const timeEl = document.getElementById('social-proof-time');

    if (!container || !flagEl || !messageEl || !timeEl) return;

    const countryName = (countryNames[lang] || countryNames.en)[signup.countryCode];
    const flag = flags[signup.countryCode];

    // Build message from random translation template
    const messages = socialProof.messages || [
      'Someone from {country} signed up with {broker}',
      'New {broker} trader from {country}',
      '{country} trader joined {broker}'
    ];
    const template = messages[Math.floor(Math.random() * messages.length)];
    const message = template
      .replace('{country}', countryName)
      .replace('{broker}', signup.broker);

    const time = (socialProof.timeAgo || '{minutes} min ago')
      .replace('{minutes}', signup.minutesAgo);

    flagEl.textContent = flag;
    messageEl.textContent = message;
    timeEl.textContent = time;

    container.classList.add('visible');

    // Auto-dismiss after display duration
    setTimeout(() => {
      container.classList.remove('visible');
    }, DISPLAY_DURATION);
  }

  // Initialize
  function init() {
    const container = document.getElementById('social-proof');
    if (!container) return;

    const state = getState();

    // Don't show if user dismissed or max reached
    if (state.dismissed || state.count >= MAX_NOTIFICATIONS) {
      return;
    }

    // Close button handler
    const closeBtn = container.querySelector('.social-proof__close');
    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        container.classList.remove('visible');
        state.dismissed = true;
        saveState(state);
      });
    }

    // Schedule notifications
    function scheduleNext() {
      const currentState = getState();
      if (currentState.dismissed || currentState.count >= MAX_NOTIFICATIONS) {
        return;
      }

      const interval = MIN_INTERVAL + Math.random() * (MAX_INTERVAL - MIN_INTERVAL);

      setTimeout(() => {
        const { signup, index } = getRandomSignup(currentState.lastIndex);
        showNotification(signup);

        currentState.count++;
        currentState.lastIndex = index;
        saveState(currentState);

        scheduleNext();
      }, interval);
    }

    // Start after initial delay
    setTimeout(() => {
      const { signup, index } = getRandomSignup(state.lastIndex);
      showNotification(signup);

      state.count++;
      state.lastIndex = index;
      saveState(state);

      scheduleNext();
    }, INITIAL_DELAY);
  }

  // Run on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
</script>

<style>
  .social-proof {
    position: fixed;
    bottom: var(--space-4);
    left: var(--space-4);
    max-width: 280px;
    z-index: 40;
    padding: var(--space-3);
    background: var(--color-bg);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--color-border);
    transform: translateX(calc(-100% - var(--space-8)));
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    pointer-events: none;
  }

  .social-proof.visible {
    transform: translateX(0);
    opacity: 1;
    pointer-events: auto;
  }

  .social-proof__close {
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
    padding: var(--space-1);
    background: transparent;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition: color var(--transition-fast), background var(--transition-fast);
    line-height: 1;
  }

  .social-proof__close:hover {
    color: var(--color-text);
    background: var(--color-bg-secondary);
  }

  .social-proof__content {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
  }

  .social-proof__flag {
    font-size: 1.5rem;
    line-height: 1;
    flex-shrink: 0;
  }

  .social-proof__text {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    padding-right: var(--space-4);
  }

  .social-proof__message {
    font-size: var(--text-sm);
    color: var(--color-text);
    line-height: var(--leading-snug);
  }

  .social-proof__time {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }

  @media (min-width: 768px) {
    .social-proof {
      max-width: 320px;
      bottom: var(--space-6);
      left: var(--space-6);
      padding: var(--space-4);
    }

    .social-proof__flag {
      font-size: 1.75rem;
    }

    .social-proof__message {
      font-size: var(--text-base);
    }
  }

  /* RTL support */
  :global([dir="rtl"]) .social-proof {
    left: auto;
    right: var(--space-4);
    transform: translateX(calc(100% + var(--space-8)));
  }

  :global([dir="rtl"]) .social-proof.visible {
    transform: translateX(0);
  }

  :global([dir="rtl"]) .social-proof__close {
    right: auto;
    left: var(--space-2);
  }

  :global([dir="rtl"]) .social-proof__text {
    padding-right: 0;
    padding-left: var(--space-4);
  }

  @media (min-width: 768px) {
    :global([dir="rtl"]) .social-proof {
      right: var(--space-6);
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .social-proof {
      transition: opacity 0.1s ease;
      transform: translateX(0);
    }

    .social-proof:not(.visible) {
      opacity: 0;
      pointer-events: none;
    }
  }
</style>
