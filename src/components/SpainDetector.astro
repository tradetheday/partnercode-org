---
/**
 * Spain Detector Component (Script Only)
 * Detects Spanish IPs and swaps AvaTrade links to AvaFutures
 * Use this on non-Spanish language pages for Spain geo-targeting
 */

interface Props {
  avafuturesUrl: string;
}

const { avafuturesUrl } = Astro.props;
---

<!-- Spain Detection Script - Swaps AvaTrade URLs to AvaFutures for Spanish IPs -->
<script define:vars={{ avafuturesUrl }}>
  async function detectSpain() {
    try {
      const response = await fetch('https://ipapi.co/json/', {
        cache: 'force-cache'
      });
      const data = await response.json();

      if (data.country_code === 'ES') {
        // User is in Spain - swap all AvaTrade CTAs to AvaFutures
        document.body.classList.add('spain-detected');

        // Swap links with data-swap-spain attribute
        document.querySelectorAll('[data-swap-spain]').forEach(el => {
          el.setAttribute('href', avafuturesUrl);
        });
      }
    } catch (error) {
      // If geo detection fails, keep default (AvaTrade)
      console.log('Geo detection unavailable');
    }
  }

  // Run on page load
  if (typeof window !== 'undefined') {
    detectSpain();
  }
</script>
